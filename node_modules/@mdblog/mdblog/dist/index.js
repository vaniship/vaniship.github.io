/* global System location */
(function () {
  'use strict'

  var script = document.createElement('script')
  script.src = 'node_modules/systemjs/dist/system.min.js'
  document.head.appendChild(script)

  var commonLibs = {
    'he': 'node_modules/he/he.js',
    'blueimp-md5': 'node_modules/blueimp-md5/js/md5.min.js',
    'qs': 'node_modules/qs/dist/qs.js',
    'jsonic': 'node_modules/jsonic/jsonic-min.js',
    'axios': 'node_modules/axios/dist/axios.js',
    'jquery': 'node_modules/jquery/dist/jquery.min.js',
    'marked': 'node_modules/marked/marked.min.js',
    'bootstrap': 'node_modules/bootstrap/dist/js/bootstrap.js',
    'bootstrap-vue': 'node_modules/bootstrap-vue/dist/bootstrap-vue.js',
    'vue': 'node_modules/vue/dist/vue.js'
  }

  window.onload = function () {
    document.body.innerHTML = '<div id="app" />'

    var _resolve = System.resolve
    System.resolve = function (id, parentURL) {
      var commonLib = commonLibs[id]
      return commonLib || _resolve.call(System, id, parentURL)
    }

    if (location.protocol === 'file:') {
      System.instantiate = function (url, firstParentUrl) {
        var loader = this
        return new Promise(function (resolve, reject) {
          var script = document.createElement('script')
          script.charset = 'utf-8'
          script.async = true
          script.addEventListener('error', function () {
            reject(new Error('Error loading ' + url + (firstParentUrl ? ' from ' + firstParentUrl : '')))
          })
          script.addEventListener('load', function () {
            document.head.removeChild(script)
            resolve(loader.getRegister())
          })
          script.src = url
          document.head.appendChild(script)
        })
      }
    }

    System.import('./node_modules/@mdblog/mdblog/dist/main.js')
  }
})()
