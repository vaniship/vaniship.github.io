define([], function () {
  var _require = window.require
  window.require = (function () {
    var tasks = []
    var timer = setInterval(function () {
      if (define.amd) {
        window.require = _require
        clearInterval(timer)
        for (var i=0,n=tasks.length;i<n;i++){
          _require.apply(null, tasks[i])
        }
        tasks = []
      }
    }, 0)
    return function () {
      tasks.push(arguments)
    }
  })()

  function render (mermaid) {
    $('div[data-code-plugin-mermaid]').each(function (index, el) {
      var $el = $(el)
      $el.show()
      $el
        .addClass('mermaid')
        .attr('data-code-plugin-mermaid', null)
        .attr('data-code-plugin-params', null)
      mermaid.init(null, el)
    })
  }
  define.amd = false
  _require(['mermaid/dist/mermaid.min'], function () {
    define.amd = true
    mermaid.initialize({startOnLoad: false, theme: 'forest'})
    render(mermaid)
  })
})
